#!/bin/sh
set -e

# Function to log messages
log() {
    echo "[$(date +'%Y-%m-%d %H:%M:%S')] $1"
}

log "Starting Revive Adserver maintenance scheduler..."

while true; do
    log "Running scheduled maintenance tasks..."
    
    # Check if maintenance script exists
    if [ -f "/var/www/html/scripts/maintenance/maintenance.php" ]; then
        php /var/www/html/scripts/maintenance/maintenance.php
        exit_code=$?
        if [ $exit_code -eq 0 ]; then
            log "Maintenance task completed successfully"
        else
            log "Maintenance task failed with exit code $exit_code"
        fi
    else
        log "Maintenance script not found, skipping..."
    fi
    
    log "Waiting 60 seconds for next maintenance run..."
    sleep 60
done
